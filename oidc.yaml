_format_version: "3.0"
plugins:
  - name: openid-connect
    enabled: true

    # Attaching to the route by its NAME
    route: google-books-library

    protocols:
      - http
      - https
    config:
      # --- YOUR ISSUER & CREDENTIALS (as arrays) ---
      issuer: https://accounts.google.com
      client_id:
        - "1033367449745-tgkqjo35chh3mqiprqqo8lfup01am8p6.apps.googleusercontent.com"
      client_secret:
        - "${OIDC_CLIENT_SECRET}" # Read from your .env

      # --- YOUR "BEARER TOKEN" FLOW ---
      auth_methods:
        - bearer
      upstream_access_token_header: "authorization:bearer"

      # --- DISABLE SESSIONS & REDIRECTS ---
      session_strategy: 'off' # This is correct
      verify_parameters: false

      # --- YOUR REQUIRED SCOPES (as an array) ---
      scopes_required:
        - "openid"
        - "email"
        - "profile"
        - "https://www.googleapis.com/auth/books"

      # --- THESE FIELDS ARE NOW REMOVED ---
      # login_action: 'off' (REMOVED - This was causing the error)
      # login_methods: [] (REMOVED - Only valid if login_action is set)
      # response_type: [] (REMOVED - Only valid if login_action is set)

      # --- ALL OTHER FIELDS (from your template) ---
      audience_claim:
        - aud
      authorization_cookie_http_only: true
      authorization_cookie_name: authorization
      authorization_cookie_path: /
      authorization_cookie_same_site: Default
      authorization_rolling_timeout: 600
      bearer_token_param_type:
        - header
        - query
        - body
      by_username_ignore_case: false
      cache_introspection: true
      cache_token_exchange: true
      cache_tokens: true
      cache_tokens_salt: 9JJj7JvcxFaEPY7iBij8j3nV9YyXh9il
      cache_ttl: 3600
      cache_user_info: true
      client_arg: client_id
      client_credentials_param_type:
        - header
        - query
        - body
      cluster_cache_redis:
        cluster_max_redirections: 5
        cluster_nodes: null
        connect_timeout: 2000
        connection_is_proxied: false
        database: 0
        host: 127.0.0.1
        keepalive_pool_size: 256
        port: 6379
        read_timeout: 2000
        send_timeout: 2000
        sentinel_nodes: null
        ssl: false
        ssl_verify: false
      cluster_cache_strategy: 'off'
      consumer_by:
        - username
        - custom_id
      consumer_groups_optional: false
      consumer_optional: false
      credential_claim:
        - sub
      display_errors: false
      dpop_proof_lifetime: 300
      dpop_use_nonce: false
      enable_hs_signatures: false
      expose_error_code: true
      forbidden_destroy_session: true
      forbidden_error_message: Forbidden
      groups_claim:
        - groups
      hide_credentials: false
      http_version: 1.1
      id_token_param_type:
        - header
        - query
        - body
      ignore_signature: []
      introspect_jwt_tokens: false
      introspection_accept: application/json
      introspection_check_active: true
      introspection_hint: access_token
      introspection_token_param_name: token
      jwt_session_claim: sid
      keepalive: true
      leeway: 0
      login_redirect_mode: fragment
      login_tokens:
        - id_token
      logout_methods:
        - POST
        - DELETE
      logout_revoke: false
      logout_revoke_access_token: true
      logout_revoke_refresh_token: true
      password_param_type:
        - header
        - query
        - body
      preserve_query_args: false
      proof_of_possession_auth_methods_validation: true
      proof_of_possession_dpop: 'off'
      proof_of_possession_mtls: 'off'
      redis:
        cluster_max_redirections: 5
        cluster_nodes: null
        connect_timeout: 2000
        connection_is_proxied: false
        database: 0
        host: 127.0.0.1
        keepalive_pool_size: 256
        port: 6379
        read_timeout: 2000
        send_timeout: 2000
        sentinel_nodes: null
        ssl: false
        ssl_verify: false
      rediscovery_lifetime: 30
      refresh_token_param_type:
        - header
        - query
        - body
      refresh_tokens: true
      resolve_distributed_claims: false
      response_mode: query
      reverify: false
      revocation_token_param_name: token
      roles_claim:
        - roles
      run_on_preflight: true
      scopes:
        - openid
      scopes_claim:
        - scope
      search_user_info: false
      session_absolute_timeout: 86400
      session_audience: default
      session_compressor: none
      session_cookie_http_only: true
      session_cookie_maxsize: 4000
      session_cookie_name: session
      session_cookie_path: /
      session_cookie_renew: 600
      session_cookie_same_site: Lax
      session_enforce_same_subject: false
      session_hash_storage_key: false
      session_hash_subject: false
      session_idling_timeout: 900
      session_memcached_host: 127.0.0.1
      session_memcached_port: 11211
      session_remember: false
      session_remember_absolute_timeout: 2592000
      session_remember_cookie_name: remember
      session_remember_rolling_timeout: 604800
      session_rolling_timeout: 3600
      session_storage: cookie
      session_store_metadata: false
      ssl_verify: false
      timeout: 10000
      tls_client_auth_ssl_verify: true
      token_cache_key_include_scope: false
      unauthorized_destroy_session: true
      unauthorized_error_message: Unauthorized
      userinfo_accept: application/json
      using_pseudo_issuer: false
      verify_claims: true
      verify_nonce: true
      verify_signature: true